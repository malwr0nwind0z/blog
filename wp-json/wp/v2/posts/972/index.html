{"id":972,"date":"2023-01-23T04:12:59","date_gmt":"2023-01-23T04:12:59","guid":{"rendered":"http:\/\/malwr0nwind0z.local\/?p=972"},"modified":"2023-12-15T10:33:12","modified_gmt":"2023-12-15T10:33:12","slug":"post_1-23-23_asyncrat_sample_part_1","status":"publish","type":"post","link":"https:\/\/malwr0nwind0z.com\/post_1-23-23_asyncrat_sample_part_1\/","title":{"rendered":"ASyncRAT delivered through malspam via OneNote attachment (Stage 1)"},"content":{"rendered":"\n<figure class=\"wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio\"><div class=\"wp-block-embed__wrapper\">\n<div class=\"ast-oembed-container \" style=\"height: 100%;\"><iframe title=\"ASyncRAT delivered through OneNote attachments\" width=\"500\" height=\"281\" src=\"https:\/\/www.youtube.com\/embed\/-lCBhme0zXM?feature=oembed\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen><\/iframe><\/div>\n<\/div><figcaption class=\"wp-element-caption\"><strong>Video 1: Watch the companion video that this blog post inspired.<\/strong><\/figcaption><\/figure>\n\n\n\n<p><\/p>\n\n\n\n<p><\/p>\n\n\n<p><strong>AsyncRat: A Remote Access Trojan (RAT)<\/strong><\/p>\n<p>AsyncRat is an open source Remote Access Trojan (RAT) that was originally released on Github. It has since been weaponized by threat actors and actively used in cyber attacks since 2019. This malware is designed to compromise the security of a target system and allow remote attackers to gain unauthorized access and control. In this blog post, we will analyze the behavior and characteristics of AsyncRat to better understand how it operates and how to protect against it.<\/p>\n\n\n<p>                                                                                 <\/p>\n\n\n<p><img decoding=\"async\" src=\"https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/12\/image-1.png\" alt=\"This image has an empty alt attribute; its file name is Asyncrat_builder.png\" \/><br \/><strong>Figure 1: AsyncRAT&#8217;s attacker control panel<\/p>\n<p><\/strong><\/p>\n<p><strong>How This AsyncRat Infection Works<\/strong><\/p>\n<p>The AsyncRat is typically delivered to the victim through various methods, including phishing emails, social engineering tactics, and exploiting vulnerabilities in unpatched software. In some cases, the malware may also be delivered through drive-by downloads, where the victim unwittingly downloads the malware while visiting a compromised website. The exact method of delivery may vary depending on the attackers&#8217; goals and the target&#8217;s specific vulnerabilities.<\/p>\n<p>In this instance it was delivered through malspam that contain a malicious Microsoft OneNote document within a zip archive named Invoice #099272663.zip. The malicious OneNote document (Invoice #099272663.one) contained a social engineering \u201cCLICK TO VIEW DOCUMENT\u201d image, that once clicked, it executes embedded VBScript.<\/p>\n<h6 style=\"text-align: center;\"><img fetchpriority=\"high\" decoding=\"async\" class=\"size-large wp-image-1001 aligncenter\" src=\"https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/01\/onenote_screenshot-1024x658.png\" alt=\"\" width=\"1024\" height=\"658\" srcset=\"https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/01\/onenote_screenshot-1024x658.png 1024w, https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/01\/onenote_screenshot-300x193.png 300w, https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/01\/onenote_screenshot-768x494.png 768w, https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/01\/onenote_screenshot.png 1398w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/>Figure 2: Embedded social engineering \u201cCLICK TO VIEW DOCUMENT\u201d image in the OneNote document (Invoice #099272663.one)<\/h6>\n<p><img decoding=\"async\" class=\"alignnone size-full wp-image-1291\" src=\"http:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/01\/asyncrat_infection_chain.jpg\" alt=\"\" width=\"572\" height=\"491\" srcset=\"https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/01\/asyncrat_infection_chain.jpg 572w, https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/01\/asyncrat_infection_chain-300x258.jpg 300w\" sizes=\"(max-width: 572px) 100vw, 572px\" \/><br \/><strong>Figure 3: AsyncRat infection chain.<\/p>\n<p><\/strong><\/p>\n<p>The VBScript invokes PowerShell to download a benign decoy OneNote document and a malicious batch script from the following URLs:<\/p>\n<p>Download URL: hxxps:\/\/www.onenotegem[.]com\/uploads\/soft\/one-templates\/the_daily_schedule.one<\/p>\n<p><a id=\"post-972-_Hlk126684701\"><\/a> Drop folder location: C:Users&lt;Username&gt;AppDataLocalTempinvoice.one (Classification: benign decoy OneNote document used to trick the victim into thinking that all is well, after clicking on the aforementioned embedded social engineering \u201cCLICK TO VIEW DOCUMENT\u201d image)<\/p>\n<p>Download URL: hxxps:\/\/transfer[.]sh\/get\/bjLvT5\/AsyncClientnownow.bat<\/p>\n<p>Drop folder location: C:Users&lt;Username&gt;AppDataLocalTempsystem32.bat (Classification: ASyncRAT loader &#8211; malicious batch file)<\/p>\n<h6 style=\"text-align: center;\"><img decoding=\"async\" class=\"alignnone size-full wp-image-1002\" src=\"https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/01\/onenote_malicious_vbscript.png\" alt=\"\" width=\"1920\" height=\"950\" srcset=\"https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/01\/onenote_malicious_vbscript.png 1920w, https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/01\/onenote_malicious_vbscript-300x148.png 300w, https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/01\/onenote_malicious_vbscript-1024x507.png 1024w, https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/01\/onenote_malicious_vbscript-768x380.png 768w, https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/01\/onenote_malicious_vbscript-1536x760.png 1536w\" sizes=\"(max-width: 1920px) 100vw, 1920px\" \/>Figure 4: Embedded VBScript that when executed downloads a decoy OneNote document and a malicious batch script.<\/h6>\n<p>Spoilers!! The batch script (AsyncClientnownow.bat) that is downloaded to the system and executed, will ultimately drop and executed a ASyncRAT executable (payload.exe). The ASyncRAT executable is written in Microsoft .NET Framework. The batch script is classified as a ASyncRAT dropper.<\/p>\n<p>Next, I will briefly discuss how the heavily obfuscated batch script works. The first part of its code is an obfuscated executable file and the second part is an base64 encoded PowerShell script.<\/p>\n<h6 style=\"text-align: center;\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-full wp-image-977\" src=\"https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/02\/graphical-user-interface-text-description-automa.png\" alt=\"Graphical user interface, text Description automatically generated\" width=\"1920\" height=\"951\" srcset=\"https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/02\/graphical-user-interface-text-description-automa.png 1920w, https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/02\/graphical-user-interface-text-description-automa-300x149.png 300w, https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/02\/graphical-user-interface-text-description-automa-1024x507.png 1024w, https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/02\/graphical-user-interface-text-description-automa-768x380.png 768w, https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/02\/graphical-user-interface-text-description-automa-1536x761.png 1536w\" sizes=\"(max-width: 1920px) 100vw, 1920px\" \/> Figure 5: Obfuscated batch script that contains an encrypted ASyncRAT binary.<\/h6>\n<p>Once the base64 encoded PowerShell script is run it is de-obfuscated during runtime. A review of this PowerShell shows that it is used to de-obfuscate the first part of code in the batch script utilizing base64 decode, AES Decryption (Key and IV), and Gunzip. The resulting de-obfuscated code turns out to be the aforementioned ASyncRAT executable file, which is then loaded into memory and executed.<\/p>\n<h6 style=\"text-align: center;\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-large wp-image-978\" src=\"https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/02\/text-description-automatically-generated-1-1024x248.png\" alt=\"Text Description automatically generated\" width=\"1024\" height=\"248\" srcset=\"https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/02\/text-description-automatically-generated-1-1024x248.png 1024w, https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/02\/text-description-automatically-generated-1-300x73.png 300w, https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/02\/text-description-automatically-generated-1-768x186.png 768w, https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/02\/text-description-automatically-generated-1.png 1279w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/> Figure 6: A portion of the de-obfuscated batch script that shows the PowerShell script.<\/h6>\n<p>During my manual analysis, I was able to decrypt the obfuscated executable file using CyberChef. As I mentioned earlier it is classified as ASyncRAT and written in Microsoft .NET Framework. I re-named this file payload.exe.<\/p>\n<h6 style=\"text-align: center;\"><img decoding=\"async\" src=\"https:\/\/malwr0nwind0z.com\/wp-content\/uploads\/2023\/02\/graphical-user-interface-text-application-descr.png\" alt=\"Graphical user interface, text, application Description automatically generated\" \/> Figure 7: De-obfuscating the first part of the batch script using CyberChef. The file header is MZ, revealing that it is a Windows executable file.<\/h6>\n<p>That ends Part 1 of this blog, which was just analyzing stage 1 of this infection. In Part 2 of this blog post I will review stage 2, which will cover the analysis of the ASyncRAT payload and dive into some of its functionalities.<\/p>\n<p><strong>IOCs:<\/strong><\/p>\n<p>Invoice #099272663.zip (MD5: 5879DA120E13BC22DE3697D4A3CB2878)<\/p>\n<p>Invoice #099272663.one (MD5: 12B1656C766432FB6FE46AB8C40EE209)<\/p>\n<p>invoice.one (the_daily_schedule.one) (MD5: 8AABD7680DBDC7EB95340D69ADA9D25C)<\/p>\n<p>system32.bat (asyncClientnownow.bat) (MD5: C3AD255AB5B6318DB06602485D8D9CA0)<\/p>\n<p>payload.exe (Original Filename: tmp4D28.tmp) (MD5: FCF99858964E59B68B0433B135B499BB)<\/p>","protected":false},"excerpt":{"rendered":"<p>AsyncRat: A Remote Access Trojan (RAT) AsyncRat is an open source Remote Access Trojan (RAT) that was originally released on Github. It has since been weaponized by threat actors and actively used in cyber attacks since 2019. This malware is designed to compromise the security of a target system and allow remote attackers to gain [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"om_disable_all_campaigns":false,"_monsterinsights_skip_tracking":false,"_monsterinsights_sitenote_active":false,"_monsterinsights_sitenote_note":"","_monsterinsights_sitenote_category":0,"site-sidebar-layout":"default","site-content-layout":"","ast-site-content-layout":"default","site-content-style":"default","site-sidebar-style":"default","ast-global-header-display":"","ast-banner-title-visibility":"","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":"","astra-migrate-meta-layouts":"set","ast-page-background-enabled":"default","ast-page-background-meta":{"desktop":{"background-color":"","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"tablet":{"background-color":"","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"mobile":{"background-color":"","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""}},"ast-content-background-meta":{"desktop":{"background-color":"var(--ast-global-color-5)","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"tablet":{"background-color":"var(--ast-global-color-5)","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"mobile":{"background-color":"var(--ast-global-color-5)","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""}},"footnotes":""},"categories":[4],"tags":[12,25,14,85,15,71,13,32,70],"aioseo_notices":[],"_links":{"self":[{"href":"https:\/\/malwr0nwind0z.com\/wp-json\/wp\/v2\/posts\/972"}],"collection":[{"href":"https:\/\/malwr0nwind0z.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/malwr0nwind0z.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/malwr0nwind0z.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/malwr0nwind0z.com\/wp-json\/wp\/v2\/comments?post=972"}],"version-history":[{"count":21,"href":"https:\/\/malwr0nwind0z.com\/wp-json\/wp\/v2\/posts\/972\/revisions"}],"predecessor-version":[{"id":1314,"href":"https:\/\/malwr0nwind0z.com\/wp-json\/wp\/v2\/posts\/972\/revisions\/1314"}],"wp:attachment":[{"href":"https:\/\/malwr0nwind0z.com\/wp-json\/wp\/v2\/media?parent=972"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/malwr0nwind0z.com\/wp-json\/wp\/v2\/categories?post=972"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/malwr0nwind0z.com\/wp-json\/wp\/v2\/tags?post=972"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}