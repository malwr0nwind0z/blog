{"id":1135,"date":"2023-05-15T13:07:17","date_gmt":"2023-05-15T13:07:17","guid":{"rendered":"https:\/\/malwr0nwind0z.com\/?p=1135"},"modified":"2023-07-26T14:54:25","modified_gmt":"2023-07-26T14:54:25","slug":"post_5-15-23_formbook_sample","status":"publish","type":"post","link":"http:\/\/malwr0nwind0z.local\/post_5-15-23_formbook_sample\/","title":{"rendered":"Stealthy Formbook leverages steganography"},"content":{"rendered":"<p><img decoding=\"async\" src=\"http:\/\/malwr0nwind0z.local\/wp-content\/uploads\/2023\/05\/a-picture-containing-stitch-description-automatic.jpeg\" alt=\"A picture containing stitch Description automatically generated with medium confidence\" \/><\/p>\n<p><strong>Formbook: A Infostealer<\/strong><\/p>\n<p>Formbook is a type of malware that is primarily used for stealing sensitive information from infected computers, was first discovered in the wild back in 2016. It is commonly distributed via malspam, or malicious spam, which is a type of spam email that contains malware or links to malware-infected websites. In this report, we will discuss a recent Formbook (version 4.1) infection that occurred via malspam.<\/p>\n<p><strong>How This Formbook Infection Works<\/strong><\/p>\n<p>In this instance it was delivered through malspam that contained a malicious Microsoft executable within a rar archive named <a id=\"post-1135-_Hlk134308079\"><\/a>scan copy-001.rar. The malicious Formbook dropper executable (scan copy-001.exe). The email is attempting to social engineer the victim into opening the rar attachment to execute the Formbook malware. The email contained urgent language, asking the victim to confirm that the attachment is a revised proforma invoice (which is an obvious ruse).<\/p>\n<pre><img decoding=\"async\" src=\"http:\/\/malwr0nwind0z.local\/wp-content\/uploads\/2023\/05\/a-picture-containing-text-screenshot-description.png\" alt=\"A picture containing text, screenshot Description automatically generated\" \/>\nFigure 1: Formbook malspam containing a malicious rar attachment (scan copy-001.exe)\n<\/pre>\n<p><strong>Technical Analysis<\/strong><\/p>\n<p>We start our analysis with scan copy-001.exe (Formbook dropper). It is a 32-bit, .NET executable file. Upon execution of scan copy-001.exe, persistence is set by creating a scheduled task to run every time the infected user logs on:<\/p>\n<p>Scheduled Task: %WINDIR%system32tasksupdatespwwigddan<\/p>\n<p>C:Users&lt;Username&gt;AppDataRoamingpWWigddan.exe (Classification: Formbook Dropper; renamed duplicate of scan copy-001.exe)<\/p>\n<p><img decoding=\"async\" src=\"http:\/\/malwr0nwind0z.local\/wp-content\/uploads\/2023\/05\/a-screenshot-of-a-computer-description-automatica.jpeg\" alt=\"A screenshot of a computer Description automatically generated with medium confidence\" \/>Figure 2: Creates a Scheduled Task to set persistence.<\/p>\n<p><img decoding=\"async\" loading=\"lazy\" src=\"http:\/\/malwr0nwind0z.local\/wp-content\/uploads\/2023\/05\/a-screenshot-of-a-computer-description-automatica-1.jpeg\" alt=\"A screenshot of a computer Description automatically generated with medium confidence\" width=\"705\" height=\"225\" \/><\/p>\n<p>Figure 3: Drops a executable file that corresponds with the scheduled task.<\/p>\n<p>The Anti-Analysis functionality includes multiple subfunctions to check for the following anti-analysis tools such as (Fig. 4 &amp; 5):<\/p>\n<ul>\n<li>DebuggerHidden: explicitly tells the debugger not to step inside of the method and no break point will be hit over that method.<\/li>\n<li>EditorBrowsable: prevents the debugger from displaying code.<\/li>\n<li>DebuggerBrowsableState.Never: hides the element from the debugger.<\/li>\n<\/ul>\n<p><img decoding=\"async\" loading=\"lazy\" src=\"http:\/\/malwr0nwind0z.local\/wp-content\/uploads\/2023\/05\/EditorBrowsable_DeuggerHidden.png\" alt=\"\" width=\"1158\" height=\"187\" \/> Figure 4: EditorBrowserable and DebuggerHidden functions.<\/p>\n<p><img decoding=\"async\" src=\"http:\/\/malwr0nwind0z.local\/wp-content\/uploads\/2023\/05\/a-screenshot-of-a-computer-program-description-au.png\" alt=\"A screenshot of a computer program Description automatically generated with medium confidence\" \/><\/p>\n<p>Figure 5: DebuggerBrowserableState.Never function.<\/p>\n<p>The\u00a0Main\u00a0function decodes the hardcoded base64 encoded module named Bunifu.UI.dll and loads it in the memory using\u00a0the Invoke\u00a0method (Figure 6).<\/p>\n<p><img decoding=\"async\" src=\"http:\/\/malwr0nwind0z.local\/wp-content\/uploads\/2023\/05\/a-screenshot-of-a-computer-program-description-au-1.png\" alt=\"A screenshot of a computer program Description automatically generated with medium confidence\" \/><br \/>\nFigure 6: Scan copy-001.exe loading Bunifu.UI.dll<\/p>\n<p>The new module Bunifu.UI.dll is an obfuscated .NET file that further executes a function to retrieve the embedded bitmap image named otQGDK, which is present in the resource of the malware file scan copy-001.exe.<\/p>\n<p>This steganography technique is used to hide malicious content in the compressed bitmap image. The successful decompression of the bitmap image retrieves another .NET file in memory which is MajorRevision.exe (Figure 8). The Bunifu.UI.dll module then loads MajorRevision.exe\u00a0using the\u00a0Assembly.Load\u00a0method; which passes the decompressed bitmap content as an argument and then invokes it.<\/p>\n<p><img decoding=\"async\" src=\"http:\/\/malwr0nwind0z.local\/wp-content\/uploads\/2023\/05\/a-screen-shot-of-a-computer-description-automatic.png\" alt=\"A screen shot of a computer Description automatically generated with medium confidence\" \/><br \/>\nFigure 7: Encrypted bitmap image (otQGDK) hiding an embedded executable (MajorRevsion.exe).<\/p>\n<p><img decoding=\"async\" src=\"http:\/\/malwr0nwind0z.local\/wp-content\/uploads\/2023\/05\/a-screenshot-of-a-computer-program-description-au-2.png\" alt=\"A screenshot of a computer program Description automatically generated with medium confidence\" \/><br \/>\nFigure 8: Successful decompression of the bitmap image retrieves another .NET file in memory which is MajorRevision.exe.<\/p>\n<p>C2 Configuration Settings<\/p>\n<p>Below are the decrypted hardcoded configuration settings:<\/p>\n<p>{&#8220;C2 list&#8221;: [&#8220;www.despachocontablequinsa.com\/m82\/&#8221;], &#8220;decoy&#8221;: [&#8220;jamesdevereux.com&#8221;, &#8220;artificialturfminneapolis.com&#8221;, &#8220;hongmeiyan.com&#8221;, &#8220;lojaderoupasbr.com&#8221;, &#8220;yit.africa&#8221;, &#8220;austinrelocationexpert.com&#8221;, &#8220;saiva.page&#8221;, &#8220;exitsategy.com&#8221;, &#8220;chochonux.com&#8221;, &#8220;klosterbraeu-unterliezheim.com&#8221;, &#8220;byseymanur.com&#8221;, &#8220;sblwarwickshire.co.uk&#8221;, &#8220;brazimaid.com&#8221;, &#8220;ciogame.com&#8221;, &#8220;bronzesailing.com&#8221;, &#8220;dwkapl.xyz&#8221;, &#8220;022dyd.com&#8221;, &#8220;compassandpathwriting.com&#8221;, &#8220;alphabet1x.com&#8221;, &#8220;selfcleaninghairbrush.co.uk&#8221;, &#8220;power-bank.co.uk&#8221;, &#8220;kickskaart.com&#8221;, &#8220;baumanbilliardsnv.com&#8221;, &#8220;bestcp.net&#8221;, &#8220;doghospitalnearme.com&#8221;, &#8220;mixano.africa&#8221;, &#8220;helarybaber.online&#8221;, &#8220;illubio.com&#8221;, &#8220;ciutas.com&#8221;, &#8220;ldpr33.ru&#8221;, &#8220;killtheblacks.com&#8221;, &#8220;cassino-portugal.com&#8221;, &#8220;danhaii.com&#8221;, &#8220;gvtowingservice.com&#8221;, &#8220;let-travel.africa&#8221;, &#8220;dental-implants-67128.com&#8221;, &#8220;facetaxi.xyz&#8221;, &#8220;ctjh9u8e.vip&#8221;, &#8220;kyosaiohruri.com&#8221;, &#8220;executivepresencetrainer.com&#8221;, &#8220;greatharmony.africa&#8221;, &#8220;feelingsarereal.com&#8221;, &#8220;devopsuday.club&#8221;, &#8220;happiestminds-udemy.com&#8221;, &#8220;fittingstands.com&#8221;, &#8220;happyhousegarment.com&#8221;, &#8220;24daysofheaven.com&#8221;, &#8220;herhustlenation.com&#8221;, &#8220;xn--oy2b27nt6b.net&#8221;, &#8220;hothotcogixem.online&#8221;, &#8220;hausmeisterservice-berlin.net&#8221;, &#8220;hjddbb.com&#8221;, &#8220;stoutfamilychiro.com&#8221;, &#8220;bookishthoughtsbychristy.com&#8221;, &#8220;gibellinaheartquake.com&#8221;, &#8220;8cf1utrb6.xyz&#8221;, &#8220;patrick-daggitt.com&#8221;, &#8220;ebcbank.net&#8221;, &#8220;angel909reviews.com&#8221;, &#8220;arcteryxsouthafricaonline.com&#8221;, &#8220;cutematvhy.com&#8221;, &#8220;art2z.com&#8221;, &#8220;bulkforeverstamps.com&#8221;, &#8220;heatbling.com&#8221;]}<\/p>\n<p>As with previous versions of Formbook, MajorRevision.exe communicates with multiple domains established as decoys, but it only uses one true C&amp;C.<\/p>\n<p><img decoding=\"async\" src=\"http:\/\/malwr0nwind0z.local\/wp-content\/uploads\/2023\/05\/a-picture-containing-text-screenshot-font-infor.png\" alt=\"A picture containing text, screenshot, font, information Description automatically generated\" \/><br \/>\nFigure 9: The C2 configuration file.<\/p>\n<p>The final payload is\u00a0retrieved from memory by converting a large array of bytes, this payload is then injected into a newly created process using Process Hollowing.<\/p>\n<p>The final Formbook payload is not a .NET application but a MASM-compiled PE32 executable composed only of a .text section.<\/p>\n<p><img decoding=\"async\" src=\"http:\/\/malwr0nwind0z.local\/wp-content\/uploads\/2023\/05\/a-screenshot-of-a-computer-program-description-au-3.png\" alt=\"A screenshot of a computer program Description automatically generated with medium confidence\" \/><br \/>\nFigure 10: Process Hollowing functions utilized to inject the final payload.<\/p>\n<p><img decoding=\"async\" src=\"http:\/\/malwr0nwind0z.local\/wp-content\/uploads\/2023\/05\/a-screenshot-of-a-computer-program-description-au-4.png\" alt=\"A screenshot of a computer program Description automatically generated with medium confidence\" \/><\/p>\n<p>Figure 11: Final Formbook payload is compiled with MASM.<\/p>\n<p><img decoding=\"async\" src=\"http:\/\/malwr0nwind0z.local\/wp-content\/uploads\/2023\/05\/a-screenshot-of-a-computer-description-automatica.png\" alt=\"A screenshot of a computer Description automatically generated\" \/><\/p>\n<p>Figure 12: The final Formbook payload only has one section (.text section).<\/p>\n<p>To prevent similar attacks in the future, organizations should implement strong email security measures, including spam filters, email authentication protocols, and user training programs. Users should be taught to recognize the signs of malspam, including suspicious attachments, urgent language, and unexpected emails from unknown senders. Additionally, organizations should use endpoint protection software and regularly update their systems to mitigate the risk of malware infections.<\/p>\n<p>In conclusion, Formbook infections via malspam are a serious threat to organizations and individuals alike. Attackers use social engineering tactics to trick victims into downloading malware, which can lead to significant data breaches and financial losses. Organizations must remain vigilant and implement robust security measures to protect against these types of attacks.<\/p>\n<p><strong>IOCs:<\/strong><\/p>\n<p>Scan copy-001.exe &#8211; MD5: 97ab2171b12f2e2b41f65c02f23da953<\/p>\n<p>Bunifu.UI.dll &#8211; MD5: 27F5124BF8F451BCA8D8A15C73C4F521<\/p>\n<p>MajorRevision.exe &#8211; MD5: 93b2754b3afa34b828cb071f036a8d31<\/p>\n<p>Formbook_payload.exe (Final payload) &#8211; MD5: E46809BB82201038371C602FA8B68531<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Formbook: A Infostealer Formbook is a type of malware that is primarily used for stealing sensitive information from infected computers, was first discovered in the wild back in 2016. It is commonly distributed via malspam, or malicious spam, which is a type of spam email that contains malware or links to malware-infected websites. In this &hellip;<\/p>\n<p class=\"read-more\"> <a class=\"\" href=\"http:\/\/malwr0nwind0z.local\/post_5-15-23_formbook_sample\/\"> <span class=\"screen-reader-text\">Stealthy Formbook leverages steganography<\/span> Read More &raquo;<\/a><\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"om_disable_all_campaigns":false,"_mi_skip_tracking":false,"_monsterinsights_sitenote_active":false,"_monsterinsights_sitenote_note":"","_monsterinsights_sitenote_category":0,"site-sidebar-layout":"default","site-content-layout":"","ast-site-content-layout":"","site-content-style":"default","site-sidebar-style":"default","ast-global-header-display":"","ast-banner-title-visibility":"","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":"","astra-migrate-meta-layouts":"","ast-page-background-enabled":"default","ast-page-background-meta":{"desktop":{"background-color":"","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"tablet":{"background-color":"","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"mobile":{"background-color":"","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""}},"ast-content-background-meta":{"desktop":{"background-color":"var(--ast-global-color-5)","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"tablet":{"background-color":"var(--ast-global-color-5)","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"mobile":{"background-color":"var(--ast-global-color-5)","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""}},"footnotes":""},"categories":[4],"tags":[30,29,24,25,14,31,26,27,28],"aioseo_notices":[],"_links":{"self":[{"href":"http:\/\/malwr0nwind0z.local\/wp-json\/wp\/v2\/posts\/1135"}],"collection":[{"href":"http:\/\/malwr0nwind0z.local\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/malwr0nwind0z.local\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/malwr0nwind0z.local\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/malwr0nwind0z.local\/wp-json\/wp\/v2\/comments?post=1135"}],"version-history":[{"count":11,"href":"http:\/\/malwr0nwind0z.local\/wp-json\/wp\/v2\/posts\/1135\/revisions"}],"predecessor-version":[{"id":1187,"href":"http:\/\/malwr0nwind0z.local\/wp-json\/wp\/v2\/posts\/1135\/revisions\/1187"}],"wp:attachment":[{"href":"http:\/\/malwr0nwind0z.local\/wp-json\/wp\/v2\/media?parent=1135"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/malwr0nwind0z.local\/wp-json\/wp\/v2\/categories?post=1135"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/malwr0nwind0z.local\/wp-json\/wp\/v2\/tags?post=1135"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}